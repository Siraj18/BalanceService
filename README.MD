# BALANCE SERVICE



### Инструкция по запуску

#### 1. Билд контейнеров
```
docker-compose build
```

#### 2. После того как образы собраны, запускаем контейнеры
```
docker-compose up -d
```


#### 3. Для приостановки контейнеров используем следующую команду
```
docker-compose down
```

#### Или же выполните следующую make команду:
```
make run_service
```


### Запросы и примеры ответов
Swagger документация доступна по следующей ссылке: http://localhost:8080/swagger/index.html   
Ниже так же расписаны curl запросы.


#### Запрос на изменение баланса
Данный запрос меняет баланс пользователя по его uuid. Если поле "money" положительное, то баланс увеличивается, если отрицательное, то уменьшается.
Изначально сервис не содержит в себе информацию о пользователях. Пользователь добавляется в базу при первом зачислении денег на счет.
```
$ curl --location --request POST 'localhost:8080/changeBalance' \
    --header 'Content-Type: application/json' \
    --data-raw '{"id": "34be95d0-9a41-11ec-b909-0242ac120003", "money": 100}'
```  

На выходе приходит json с полями id, balance или же сообщение об ошибке, если изменение баланса не удалось.

#### Запрос на получение баланса
Данный запрос получает баланс пользователя по его uuid. 
```
$ curl --location --request GET 'localhost:8080/balance/34be95d0-9a41-11ec-b909-0242ac120003' \
    --header 'Content-Type: application/json'
```

На выходе приходит json с полями id, balance или же сообщение об ошибке, если получение баланса не удалось.
#### Запрос на перевод средств
Данный запрос приминает в себя uuid пользователей и также необходимую сумму для перевода.
```
curl --location --request POST 'localhost:8080/transferBalance' \
    --header 'Content-Type: application/json' \
    --data-raw '{"from_id": "34be95d0-9a41-11ec-b909-0242ac120003", "to_id": "34be95d0-9a41-11ec-b909-0242ac120004", "money": 50}'
```


На выходе приходит сообщение об успешности перевода или же сообщение об ошибке, если перевод не удался.
#### Запрос на получение списка транзакций
Данный запрос принимает на вход uuid пользователя. На вывод он дает все транзакции, в которых замешан данные uuid. Также предусмотрена фильтрация и пагинация   
данных. Фильтры: "date_asc", "date_desc", "money_asc", "money_desc".
```
$ curl --location --request POST 'localhost:8080/allTransactions' \
    --header 'Content-Type: application/json' \
    --data-raw '{"id": "34be95d0-9a41-11ec-b909-0242ac120003", "sort_type":"date_asc", "limit": 10, "page":1}'
```
На выходе приходит json массив со списком транзакций

#### Запрос на резервирование денег на отдельном счете
Данный запрос принимает на вход id счета пользователя, id услуги, id заказа, сумму по заказу.
```
$ curl --location --request POST 'localhost:8080/reserveMoney' \
    --header 'Content-Type: application/json' \
    --data-raw '{"user_id": "34be95d0-9a41-11ec-b909-0242ac120003", "service_id":"someserviceid1", "order_id": "someorder1", "amount":10}'
```

На выходе приходит сообщение об успешности резервирования или же сообщение об ошибке, если резервирование не удалось.
#### Запрос для разрезервирования денег
Данный запрос принимает на вход id счета пользователя, id услуги, id заказа, сумму по заказу.
```
$ curl --location --request POST 'localhost:8080/deReserveMoney' \
    --header 'Content-Type: application/json' \
    --data-raw '{"user_id": "34be95d0-9a41-11ec-b909-0242ac120003", "service_id":"someserviceid1", "order_id": "someorder1", "amount":10}'
```
На выходе приходит сообщение об успешности разрезервирования или же сообщение об ошибке, если разрезервирование не удалось.
#### Запрос для признания выручки
Данный запрос принимает на вход id счета пользователя, id услуги, id заказа, сумму по заказу.
```
$ curl --location --request POST 'localhost:8080/recognizeMoney' \
    --header 'Content-Type: application/json' \
    --data-raw '{"user_id": "34be95d0-9a41-11ec-b909-0242ac120003", "service_id":"someserviceid1", "order_id": "someorder1", "amount":10}'
```
На выходе приходит сообщение об успешности признания выручки или же сообщение об ошибке, если признание выручки не удалось.
#### Запрос для генерации отчета по выручке
На входный подается год и месяц, по которым надо сгенерировать отчет.
```
$ curl --location --request POST 'localhost:8080/getReportLink' \
    --header 'Content-Type: application/json' \
    --data-raw '{"year": 2022, "month":10}'
```

На выходе приходит ссылка, перейдя по которой начнется скачивание .csv файла с отчетом по указанному временному промежтку
### Запуск тестов

#### Команда для запуска тестов
```
go test ./... -cover
```
